import React from "react"
import Head from 'next/head'
import { NextPage } from "next"
import { Result, getRandomWord } from '../library/api/querys'
import { Form, Button } from 'react-bootstrap'
import NavbarComponent from "../componets/navbar"

const Test: NextPage = () => {
    const [randomWord, setRandomWord] = React.useState<Result | null>(null)
    const [translatedWord, setTranslatedWord] = React.useState<string>("")
    const [solved, setSolved] = React.useState<boolean>(false)

    const translateInput = React.useRef<HTMLInputElement | null>()

    React.useEffect(() => {
        getRandomWord()
            .then(result => setRandomWord(result))
    }, [])

    const Solution = () => {
        return solved && randomWord ?
            <div>
                {
                    randomWord.englishWord.toLocaleLowerCase() == translatedWord.toLocaleLowerCase() ?
                        <div>Congratulations your answer is correct!</div>
                        :
                        <div>Your answer is wrong, the correct translation is {randomWord?.englishWord}</div>
                }
            </div>
            :
            null
    }

    const getNewWord = () => {
        getRandomWord()
            .then(result => {
                setRandomWord(result)
                setSolved(false)
                setTranslatedWord("")

                if (translateInput.current) {
                    translateInput.current.focus()
                }
            })
    }

    return (
        <>
            <Head>
                <title>Words test</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/translation.png" />
            </Head>

            <NavbarComponent />

            <main style={localStyles.mainElement}>
                <div>How is {randomWord?.spanishWord} spelled in english?</div>

                <Form onSubmit={
                    ev => {
                        ev.preventDefault()
                        setSolved(true)
                    }
                }>
                    <Form.Control
                        type="text"
                        placeholder="Guess word"
                        value={translatedWord}
                        ref={translateInput}
                        onChange={ev => setTranslatedWord(ev.target.value)}
                        autoFocus
                    />

                    <Solution />

                    <div style={localStyles.buttons}>
                        <Button
                            variant="primary"
                            type="submit"
                            style={localStyles.checkAnswerButton}
                        >Check answer</Button>
                        <Button variant="primary" type="button" onClick={getNewWord}>Get new word</Button>
                    </div>
                </Form>
            </main>
        </>
    )
}

const localStyles = {
    checkAnswerButton: {
        marginRight: "20px"
    },

    buttons: {
        marginTop: "10px"
    },

    mainElement: {
        marginTop: "20px",
        paddingLeft: "20px",
        paddingRight: "20px"
    }
}

export default Test